@inject IJSRuntime JSRuntime

<CascadingValue Value="this">
    <SourceNodeTreeItem Model="@RootModel" @ref="RootItem" />
</CascadingValue>

@code {
    [Parameter]
    public SourceNodeTreeItemBase ActiveItem { get; set; }

    [Parameter]
    public EventCallback<SourceNodeTreeItemBase> ActiveItemChanged { get; set; }

    [Parameter]
    public SourceNode Root { get; set; }

    public SourceNodeTreeItem RootItem { get; private set; }

    SingleNodeTreeItemModel RootModel { get; set; }

    protected override void OnParametersSet()
    {
        if (RootModel?.Node != Root)
        {
            RootModel = new SingleNodeTreeItemModel(Root);
        }
        if (RootItem?.Contains(ActiveItem) != true)
        {
            ActiveItem = RootItem;
        }
    }

    public ValueTask SelectNode(SourceNodeTreeItemBase treeItem)
    {
        ActiveItem = treeItem;
        ActiveItemChanged.InvokeAsync(ActiveItem);
        StateHasChanged();
        return JSRuntime.Focus(treeItem.FocusableElementRef);
    }
}
